{"schemaVersion":{"major":0,"minor":3,"patch":0},"kind":"article","seeAlsoSections":[{"generated":true,"identifiers":["doc:\/\/SwiftQL\/documentation\/SwiftQL\/Queries","doc:\/\/SwiftQL\/documentation\/SwiftQL\/LiveQueries","doc:\/\/SwiftQL\/documentation\/SwiftQL\/Expressions","doc:\/\/SwiftQL\/documentation\/SwiftQL\/BuiltinFunctions","doc:\/\/SwiftQL\/documentation\/SwiftQL\/FunctionalSyntax"],"anchor":"Essentials","title":"Essentials"}],"primaryContentSections":[{"content":[{"type":"heading","level":2,"text":"Overview","anchor":"Overview"},{"inlineContent":[{"type":"text","text":"This guide covers the fundamental functionality provided by SwiftQL. After"},{"type":"text","text":" "},{"type":"text","text":"completing this you will be able to perform essential database operations"},{"type":"text","text":" "},{"type":"text","text":"using SwiftQL."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"This guide assumes cursory understanding of SQL as used in SQLite. This guide","type":"text"},{"text":" ","type":"text"},{"text":"will not attempt to teach SQL, but aims to provide sufficient detail to be","type":"text"},{"text":" ","type":"text"},{"text":"useful to non-experts and newcomers to SQL.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"Please refer to the","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/www.sqlite.org\/lang.html","isActive":true,"type":"reference"},{"text":" for a more","type":"text"},{"text":" ","type":"text"},{"text":"comprehensive discussion about using SQL.","type":"text"}]},{"anchor":"Defining-tables","text":"Defining tables","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"text":"Before we can query our database we need to define the structure of our tables.","type":"text"},{"text":" ","type":"text"},{"text":"A table is defined using a ","type":"text"},{"code":"struct","type":"codeVoice"},{"text":", annotated with ","type":"text"},{"code":"@SQLTable","type":"codeVoice"},{"text":":","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["import SwiftQL","","@SQLTable struct Person {","    var id: String","    var occupationId: String?","    var name: String","    var age: Int","} "]},{"type":"paragraph","inlineContent":[{"text":"This defines a table named ","type":"text"},{"code":"Person","type":"codeVoice"},{"text":" with some properties. SwiftQL supports the","type":"text"},{"text":" ","type":"text"},{"text":"following intrinsic (fundamental) properties which correspond to SQLite counter","type":"text"},{"text":" ","type":"text"},{"text":"parts:","type":"text"}]},{"rows":[[[{"inlineContent":[{"type":"text","text":"SwiftQL"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"SQLite"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"Bool"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"INTEGER (0 or 1)"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"Int"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"INTEGER"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"Double"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"REAL"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"String"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"TEXT"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"Data"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"BLOB"}],"type":"paragraph"}]]],"header":"row","type":"table"},{"type":"paragraph","inlineContent":[{"text":"SwiftQL also supports optional types, which correspond to a ","type":"text"},{"code":"NULL","type":"codeVoice"},{"text":" column in","type":"text"},{"text":" ","type":"text"},{"text":"SQLite.","type":"text"}]},{"anchor":"Creating-tables","text":"Creating tables","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"Before you can use your table you need to create it. In SwiftQL we can use the","type":"text"},{"text":" ","type":"text"},{"code":"sqlCreate","type":"codeVoice"},{"text":" helper function to create a basic table. SwiftQL also allows you to","type":"text"},{"text":" ","type":"text"},{"text":"to create tables using ","type":"text"},{"code":"Select","type":"codeVoice"},{"text":" statements, which we will look at later.","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["let createPersonStatement = sqlCreate(Person.self)"]},{"type":"paragraph","inlineContent":[{"text":"This would be equivalent to writing the following SQL:","type":"text"}]},{"syntax":"sql","type":"codeListing","code":["CREATE TABLE IF NOT EXISTS Person (","    id TEXT NOT NULL,","    occupationId TEXT NULL,","    name TEXT NOT NULL,","    age INT NOT NULL",");"]},{"type":"paragraph","inlineContent":[{"text":"SwiftQL translates to the Swift types to a compatible intrinsic type in SQLite.","type":"text"},{"text":" ","type":"text"},{"text":"Non-optional fields are been defined as ","type":"text"},{"code":"NOT NULL","type":"codeVoice"},{"text":", while optional fields are","type":"text"},{"text":" ","type":"text"},{"text":"defined as ","type":"text"},{"code":"NULL","type":"codeVoice"},{"text":".","type":"text"}]},{"content":[{"inlineContent":[{"type":"text","text":"The "},{"type":"codeVoice","code":"IF NOT EXISTS"},{"type":"text","text":" term is added by SwiftQL, and informs SQLite to"},{"type":"text","text":" "},{"type":"text","text":"bypass creating the table if it already exists. This allows us to safely execute"},{"type":"text","text":" "},{"type":"text","text":"the  create statement when our app starts, without first needing to check if the"},{"type":"text","text":" "},{"type":"text","text":"table already exists."}],"type":"paragraph"}],"name":"Note","type":"aside","style":"note"},{"anchor":"Executing-statements","text":"Executing statements","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"text":"SwiftQL provides a default implementation using GRDB for running statements","type":"text"}]},{"content":[{"inlineContent":[{"type":"text","text":"Support for alternative database providers is currently under"},{"type":"text","text":" "},{"type":"text","text":"development."}],"type":"paragraph"}],"name":"Note","type":"aside","style":"note"},{"type":"paragraph","inlineContent":[{"text":"First we initialize our database:","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["let directory = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask)[0]","let file = directory.appending(path: \"my_database.sqlite\")","let database = try GRDBDatabase(url: file)"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Once the database is initialised, we can create and execute the statement:"}]},{"syntax":"swift","type":"codeListing","code":["try database.makeRequest(with: createPersonStatement).execute()"]},{"inlineContent":[{"text":"The database initialization and table creation only needs to happen once in the","type":"text"},{"text":" ","type":"text"},{"text":"application life cycle.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"We will follow this pattern of creating and executing statements throughout this","type":"text"},{"type":"text","text":" "},{"text":"tutorial.","type":"text"}]},{"anchor":"Inserting-data","text":"Inserting data","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Our database has been created but it is currently empty. Let’s add some data."},{"type":"text","text":" "},{"type":"text","text":"First we create an instance of our table struct:"}]},{"syntax":null,"type":"codeListing","code":["let fredPerson = Person(","    id: \"fred\",","    occupationId: nil,","    name: \"Fred\",","    age: \"31\"",")"]},{"inlineContent":[{"text":"We can then create and execute the request:","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":null,"code":["try database.makeRequest(with: sqlInsert(fredPerson)).execute()"]},{"inlineContent":[{"text":"This is equivalent to running the following SQL:","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"sql","code":["INSERT INTO Person (id, occupationId, name, age)","VALUES ('fred', NULL, 'Fred', 31)"]},{"type":"heading","level":2,"text":"Running select queries","anchor":"Running-select-queries"},{"inlineContent":[{"text":"Now that we have some data, we can run a select query. In the example below we","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"prepare the query and execute it:"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["let query = sql { schema in","    let person = schema.table(Person.self)","    Select(person)","    From(person)","    Where(person.name == 'Fred')","}","let result = try database.makeRequest(with: query).fetchAll()"]},{"inlineContent":[{"type":"text","text":"The "},{"code":"result","type":"codeVoice"},{"text":" will contain an array of ","type":"text"},{"code":"Person","type":"codeVoice"},{"type":"text","text":" objects matching the query."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"We used "},{"code":"fetchAll","type":"codeVoice"},{"text":" to execute a select query instead of calling  ","type":"text"},{"code":"execute","type":"codeVoice"},{"type":"text","text":"."},{"text":" ","type":"text"},{"type":"text","text":"Using "},{"code":"fetchAll","type":"codeVoice"},{"text":" returns an array of all of the matching records for the query.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"We can also use "},{"code":"fetchOne","type":"codeVoice"},{"text":" to fetch only the first result from the query.","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["let firstResult = try database.makeRequest(with: query).fetchOne()"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Select statement syntax is discussed in more detail the "},{"identifier":"doc:\/\/SwiftQL\/documentation\/SwiftQL\/Queries","isActive":true,"type":"reference"},{"type":"text","text":" guide."}]},{"anchor":"Schema-parameter","text":"Schema parameter","type":"heading","level":3},{"inlineContent":[{"text":"In the example above we used a ","type":"text"},{"code":"schema","type":"codeVoice"},{"text":" parameter in the ","type":"text"},{"code":"sql","type":"codeVoice"},{"text":" function to","type":"text"},{"text":" ","type":"text"},{"text":"construct a reference to the table used in the query. A common convention is to","type":"text"},{"text":" ","type":"text"},{"text":"omit the ","type":"text"},{"code":"schema","type":"codeVoice"},{"text":" parameter name entirely and use the default parameter name","type":"text"},{"text":" ","type":"text"},{"code":"$0","type":"codeVoice"},{"text":" instead:","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["let query = sql { ","    let person = $0.table(Person.self)","    Select(person)","    From(person)","    Where(person.name == 'Fred')","}"]},{"inlineContent":[{"text":"The guide documentation use the explicit ","type":"text"},{"type":"codeVoice","code":"schema"},{"text":" for clarity.","type":"text"}],"type":"paragraph"},{"type":"heading","level":3,"text":"Prepared statements","anchor":"Prepared-statements"},{"inlineContent":[{"text":"So far we have made the request each time we needed to execute it. Instead we","type":"text"},{"text":" ","type":"text"},{"text":"can store the request and reuse it later. When the request is created SwiftQL","type":"text"},{"text":" ","type":"text"},{"text":"will use an SQLite prepared statement. SQLite will parse the SQL string into","type":"text"},{"text":" ","type":"text"},{"text":"low-level byte code which can be executed efficiently, without needing to parse","type":"text"},{"text":" ","type":"text"},{"text":"the SQL each time. Re-using requests can potentially improve performance of","type":"text"},{"text":" ","type":"text"},{"text":"complex queries at runtime.","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["let query = sql { schema in","    let person = schema.table(Person.self)","    Select(person)","    From(person)","    Where(person.age >= 21 && person.age < 65)","}","let request = try database.makeRequest(with: query)"]},{"inlineContent":[{"type":"text","text":"Once created we can call the prepared statement whenever it is needed."}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["let result = try request.fetchAll()"]},{"text":"Variables","type":"heading","level":2,"anchor":"Variables"},{"type":"paragraph","inlineContent":[{"type":"text","text":"SwiftQL allows you to use variables in queries in a type-safe manner."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"First define a variable binding using the generic "},{"code":"XLNamedBindingReference","type":"codeVoice"},{"type":"text","text":", and"},{"text":" ","type":"text"},{"text":"specifying the type of the variable, as well as a name. The name is used for","type":"text"},{"type":"text","text":" "},{"text":"debugging SQL statements as does not affect the query:","type":"text"}]},{"type":"codeListing","code":["let nameParameter = XLNamedBindingReference<String>(name: \"name\")"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"We can include the variable parameter in a query:"}]},{"syntax":"swift","code":["let query = sql { schema in","    let person = schema.table(Person.self)","    Select(person)","    From(person)","    Where(person.name == nameParameter)","}","let request = try database.makeRequest(with: query)"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"This is equivalent to the following SQL:"}],"type":"paragraph"},{"syntax":"sql","code":["SELECT *","FROM Person AS person","WHERE person.name == :name"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"The name parameter is not assigned to a value yet. We assign the parameter value","type":"text"},{"text":" ","type":"text"},{"text":"when we execute the query. A best practice when assigning parameters is to","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"create a copy of the request then assign the parameter. We can take advantage of"},{"type":"text","text":" "},{"type":"text","text":"copy-on-write semantics for value types:"}]},{"type":"codeListing","code":["var newRequest = request","newRequest.set(nameParameter, \"Fred\")","return try request.fetchAll()"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This binds the value “Fred” to the name parameter in the context of the request"},{"type":"text","text":" "},{"type":"text","text":"before fetching all of the matching results."}]},{"type":"heading","text":"Update statements","anchor":"Update-statements","level":2},{"type":"paragraph","inlineContent":[{"text":"We can modify an existing record using an update statement. In this example we","type":"text"},{"text":" ","type":"text"},{"text":"set the age of the person whose id is ","type":"text"},{"code":"fred","type":"codeVoice"},{"text":" to the value ","type":"text"},{"code":"42","type":"codeVoice"},{"text":".","type":"text"}]},{"type":"codeListing","code":["let updateStatement = sql { schema in","    let person = schema.into(Person.self)","    Update(person)","    Setting<Person> { row in","        row.age = 42","    }","    Where(","        person.id == 'fred'","    )","}","","try database.makeRequest(with: updateStatement).execute()"],"syntax":"swift"},{"type":"aside","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Use "},{"code":"schema.into()","type":"codeVoice"},{"type":"text","text":" when defining a table that is modified in the query."}]}],"name":"Note","style":"note"},{"type":"aside","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Omitting the where clause will update all of the records in the"},{"type":"text","text":" "},{"type":"text","text":"table. A  best practice when using update statements is to always specify a"},{"type":"text","text":" "},{"type":"text","text":"where clause to limit the scope of changes."}]}],"name":"Warning","style":"warning"},{"type":"paragraph","inlineContent":[{"text":"We can also a prepared statement with named parameters for common update","type":"text"},{"text":" ","type":"text"},{"text":"operations:","type":"text"}]},{"type":"codeListing","code":["let idParameter = XLNamedBindingReference<String>(name: \"id\")","let ageParameter = XLNamedBindingReference<Int>(name: \"age\")","","let updateStatement = sql { schema in","    let person = schema.into(Person.self)","    Update(person)","    Setting<Person> { row in","        row.age = ageParameter","    }","    Where(","        person.id == idParameter","    )","}","","let updateRequest = try database.makeRequest(with: updateStatement)","","...","","var newUpdateRequest = updateRequest","newUpdateRequest.set(idParameter, \"fred\")","newUpdateRequest.set(ageParameter, 42)","try newUpdateRequest.execute()"],"syntax":"swift"},{"type":"heading","text":"Delete statements","anchor":"Delete-statements","level":2},{"type":"paragraph","inlineContent":[{"text":"We can delete records by specifying the table and a where clause for the items","type":"text"},{"text":" ","type":"text"},{"text":"to delete. The example shows a prepared statement with parameters:","type":"text"}]},{"type":"codeListing","code":["let idParameter = XLNamedBindingReference<String>(name: \"id\")","","let deleteStatement = sql { schema in","    let person = schema.into(Person.self)","    Delete(person)","    Where(person.id == idParameter)","}","","let deleteRequest = try database.makeRequest(with: deleteStatement)","","...","","var newDeleteRequest = deleteRequest","newDeleteRequest.set(idParameter, \"fred\")","try newDeleteRequest.execute()"],"syntax":"swift"}],"kind":"content"}],"metadata":{"roleHeading":"Article","title":"Getting started","role":"article","modules":[{"name":"SwiftQL"}]},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/SwiftQL\/documentation\/SwiftQL\/GettingStarted"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/swiftql\/gettingstarted"]}],"sections":[],"hierarchy":{"paths":[["doc:\/\/SwiftQL\/documentation\/SwiftQL"]]},"abstract":[{"type":"text","text":"Introduces the basic concepts and usage of SwiftQL."}],"references":{"https://www.sqlite.org/lang.html":{"titleInlineContent":[{"type":"text","text":"SQLite SQL Language Documentation"}],"identifier":"https:\/\/www.sqlite.org\/lang.html","url":"https:\/\/www.sqlite.org\/lang.html","type":"link","title":"SQLite SQL Language Documentation"},"doc://SwiftQL/documentation/SwiftQL":{"kind":"symbol","role":"collection","title":"SwiftQL","identifier":"doc:\/\/SwiftQL\/documentation\/SwiftQL","url":"\/documentation\/swiftql","abstract":[{"text":"Write SQL using familiar type-safe Swift syntax.","type":"text"}],"type":"topic"},"doc://SwiftQL/documentation/SwiftQL/Queries":{"kind":"article","title":"Select Queries","role":"article","identifier":"doc:\/\/SwiftQL\/documentation\/SwiftQL\/Queries","type":"topic","url":"\/documentation\/swiftql\/queries","abstract":[{"text":"Use joins, aggregates, sorting, subqueries, and common table expressions.","type":"text"}]},"doc://SwiftQL/documentation/SwiftQL/BuiltinFunctions":{"kind":"article","title":"Built-in Functions","role":"article","identifier":"doc:\/\/SwiftQL\/documentation\/SwiftQL\/BuiltinFunctions","type":"topic","url":"\/documentation\/swiftql\/builtinfunctions","abstract":[{"text":"Functions provided by SwiftQL.","type":"text"}]},"doc://SwiftQL/documentation/SwiftQL/FunctionalSyntax":{"kind":"article","role":"article","title":"Functional Syntax","identifier":"doc:\/\/SwiftQL\/documentation\/SwiftQL\/FunctionalSyntax","url":"\/documentation\/swiftql\/functionalsyntax","abstract":[{"text":"Use functional syntax with SwiftQL.","type":"text"}],"type":"topic"},"doc://SwiftQL/documentation/SwiftQL/LiveQueries":{"kind":"article","title":"Live queries","role":"article","type":"topic","identifier":"doc:\/\/SwiftQL\/documentation\/SwiftQL\/LiveQueries","url":"\/documentation\/swiftql\/livequeries","abstract":[{"type":"text","text":"Use Combine Publishers to observe changes to the database."}]},"doc://SwiftQL/documentation/SwiftQL/Expressions":{"kind":"article","role":"article","title":"Expressions","identifier":"doc:\/\/SwiftQL\/documentation\/SwiftQL\/Expressions","url":"\/documentation\/swiftql\/expressions","type":"topic","abstract":[{"text":"In depth discussion of expressions in SwiftQL.","type":"text"}]}}}